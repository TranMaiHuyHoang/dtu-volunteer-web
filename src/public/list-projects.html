<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh sách dự án</title>
</head>
<body>
    <main>
        <h1>Danh sách dự án</h1>
        <div>
            <button onclick="loadProjects()">Tải danh sách</button>
            <a href="/projects/create"><button>Tạo dự án mới</button></a>
        </div>
        <div id="projects-list"></div>
    </main>

    <script type="module" src="/js/utils/fetchApi.js"></script>
    <script type="module" src="/js/utils/promiseHelper.js"></script>
    <script type="module" src="/js/utils/fetchHelper.js"></script>
    <script type="module" src="/js/layout.js"></script>

    <script>
        async function loadProjects() {
            setElementHTML('projects-list', 'Đang tải...');
            
            const [error, res] = await to(
                fetchApi('/projects', 'GET', null, { useSession: true })
            );
            
            if (error) {
                setElementHTML('projects-list', `<p>Lỗi: ${error.message}</p>`);
                return;
            }
            
            const projects = res.data || res;
            
            if (projects?.length) {
                const formatDate = d => d ? new Date(d).toLocaleDateString('vi-VN') : 'N/A';
                const html = `
                    <table border="1">
                        <thead>
                            <tr><th>Tiêu đề</th><th>Mô tả</th><th>Địa điểm</th><th>Ngày bắt đầu</th><th>Ngày kết thúc</th><th>Trạng thái</th><th>Người tạo</th></tr>
                        </thead>
                        <tbody>
                            ${projects.map(p => `
                                <tr>
                                    <td>${p.title || 'N/A'}</td>
                                    <td>${p.description || 'N/A'}</td>
                                    <td>${p.location || 'N/A'}</td>
                                    <td>${formatDate(p.startDate)}</td>
                                    <td>${formatDate(p.endDate)}</td>
                                    <td>${p.status || 'N/A'}</td>
                                    <td>${p.createdBy?.name || p.createdBy?.email || 'N/A'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                setElementHTML('projects-list', html);
            } else {
                setElementHTML('projects-list', '<p>Không có dự án nào.</p>');
            }
        }
        
        loadProjects();
    </script>
</body>
</html>

