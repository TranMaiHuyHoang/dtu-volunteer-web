@baseUrl = http://localhost:3000

###
# ============================================
# FINANCE API TESTS
# ============================================
# Các test case cho Finance API endpoints
# ============================================

###
# 1. Đăng nhập để lấy token
# @name loginRequest
POST {{baseUrl}}/login
Content-Type: application/json

{
    "email": "dangtunaminh@gmail.com",
    "password": "password"
}

###
# Lưu token vào biến
@userToken = {{loginRequest.response.body.token}}
@mongoUserId = 68fcbf65522d0ac03ce02bff

###
# ============================================
# GET USER FINANCE
# ============================================

###
# 2. Lấy thông tin tài chính người dùng (Success)
# @name getUserFinance
GET {{baseUrl}}/finance/user/{{mongoUserId}}
Authorization: Bearer {{userToken}}
Content-Type: application/json

###
# Example Response (Success):
# {
#   "id": 1,
#   "mongo_user_id": "68fcbf65522d0ac03ce02bff",
#   "balance": 1000.00,
#   "created_at": "2025-11-07T00:00:00.000Z",
#   "updated_at": "2025-11-07T00:00:00.000Z"
# }

###
# 3. Lấy thông tin tài chính người dùng không tồn tại (404)
GET {{baseUrl}}/finance/user/000000000000000000000000
Authorization: Bearer {{userToken}}
Content-Type: application/json

###
# Example Response (404):
# {
#   "message": "User not found"
# }

###
# 4. Lấy thông tin tài chính không có token (401)
GET {{baseUrl}}/finance/user/{{mongoUserId}}
Content-Type: application/json

###
# Example Response (401):
# {
#   "message": "Không được ủy quyền. Vui lòng cung cấp token."
# }

###
# ============================================
# ADD TRANSACTION - DEPOSIT
# ============================================

###
# 5. Thêm giao dịch nạp tiền (Deposit) - Success
# @name addDepositTransaction
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 500.00,
    "type": "deposit",
    "description": "Nạp tiền vào tài khoản"
}

###
# Example Response (Success):
# {
#   "message": "Transaction recorded successfully"
# }

###
# 6. Thêm giao dịch nạp tiền với số tiền lớn
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 10000.00,
    "type": "deposit",
    "description": "Nạp tiền thưởng"
}

###
# ============================================
# ADD TRANSACTION - WITHDRAW
# ============================================

###
# 7. Thêm giao dịch rút tiền (Withdraw) - Success
# @name addWithdrawTransaction
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 200.00,
    "type": "withdraw",
    "description": "Rút tiền để thanh toán"
}

###
# Example Response (Success):
# {
#   "message": "Transaction recorded successfully"
# }

###
# 8. Thêm giao dịch rút tiền với số tiền nhỏ
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 50.00,
    "type": "withdraw",
    "description": "Rút tiền phí dịch vụ"
}

###
# ============================================
# VALIDATION TESTS
# ============================================

###
# 9. Thêm giao dịch thiếu userId (400)
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "amount": 100.00,
    "type": "deposit",
    "description": "Test thiếu userId"
}

###
# Example Response (400/500):
# {
#   "error": "..."
# }

###
# 10. Thêm giao dịch thiếu amount (400)
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "type": "deposit",
    "description": "Test thiếu amount"
}

###
# 11. Thêm giao dịch thiếu type (400)
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 100.00,
    "description": "Test thiếu type"
}

###
# 12. Thêm giao dịch type không hợp lệ (400)
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 100.00,
    "type": "invalid_type",
    "description": "Test type không hợp lệ"
}

###
# 13. Thêm giao dịch amount âm (400)
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": -100.00,
    "type": "deposit",
    "description": "Test amount âm"
}

###
# 14. Thêm giao dịch amount = 0 (400)
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 0,
    "type": "deposit",
    "description": "Test amount = 0"
}

###
# 15. Thêm giao dịch không có token (401)
POST {{baseUrl}}/finance/transaction
Content-Type: application/json

{
    "userId": 1,
    "amount": 100.00,
    "type": "deposit",
    "description": "Test không có token"
}

###
# ============================================
# EDGE CASES
# ============================================

###
# 16. Lấy thông tin tài chính với MongoDB ID không hợp lệ format
GET {{baseUrl}}/finance/user/invalid-id-format
Authorization: Bearer {{userToken}}
Content-Type: application/json

###
# 17. Thêm giao dịch với userId không tồn tại
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 99999,
    "amount": 100.00,
    "type": "deposit",
    "description": "Test userId không tồn tại"
}

###
# 18. Thêm giao dịch với mô tả dài
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 100.00,
    "type": "deposit",
    "description": "Đây là một mô tả rất dài để test xem hệ thống có xử lý được không khi mô tả có nhiều ký tự và có thể chứa các ký tự đặc biệt như: !@#$%^&*()_+-=[]{}|;:,.<>?"
}

###
# 19. Thêm nhiều giao dịch liên tiếp để test balance update
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 100.00,
    "type": "deposit",
    "description": "Giao dịch 1"
}

###
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 50.00,
    "type": "withdraw",
    "description": "Giao dịch 2"
}

###
POST {{baseUrl}}/finance/transaction
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
    "userId": 1,
    "amount": 200.00,
    "type": "deposit",
    "description": "Giao dịch 3"
}

###
# 20. Kiểm tra balance sau các giao dịch
GET {{baseUrl}}/finance/user/{{mongoUserId}}
Authorization: Bearer {{userToken}}
Content-Type: application/json

###
# ============================================
# NOTES
# ============================================
# - Thay đổi {{mongoUserId}} bằng MongoDB ID thực tế của user
# - Thay đổi userId trong transaction requests bằng finance user ID thực tế
# - Đảm bảo MySQL database đã được setup với tables:
#   - users_finance (id, mongo_user_id, balance, created_at, updated_at)
#   - transactions (id, user_id, amount, type, description, created_at)
# - Token sẽ tự động được lấy từ login request
# ============================================

