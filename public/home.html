<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home - Test API</title>
    <link rel="stylesheet" href="/css/message.css">
</head>
<body>
    <h1>Home - Test API</h1>
    
    <div id="logout-message" class="message-container"></div>
    
    <h2>User Profile:</h2>
    <div id="profile"></div>
    
    <h2>Notifications:</h2>
    <div id="notifications"></div>
    
    <button onclick="loadData()">Load Data</button>

    <script src="/js/fetchApi.js"></script>
    <script src="/js/layout.js"></script>
    <script>
        // Helper function để set content cho element (DRY principle)
        function setElementContent(elementId, content) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = content;
            }
        }

        async function loadData() {
            // Token được lưu trong cookie (httpOnly), tự động gửi kèm request
            // Middleware sẽ tự động lấy token từ cookie hoặc Authorization header
            try {
                // Cookie tự động được gửi kèm, không cần gọi /auth/token
                const profileData = await fetchApi('/profile', 'GET', null, '', { useSession: true });
                setElementContent('profile', JSON.stringify(profileData, null, 2));
            } catch (error) {
                setElementContent('profile', 'Error loading profile: ' + error.message);
            }
            
            // Fetch notifications
            try {
                const notifData = await fetchApi('/notifications/me', 'GET', null, '', { useSession: true });
                setElementContent('notifications', JSON.stringify(notifData, null, 2));
            } catch (error) {
                setElementContent('notifications', 'Error loading notifications: ' + error.message);
            }
        }
    </script>
</body>
</html>

